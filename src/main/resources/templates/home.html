<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>KUHAS 부원 모집 지원서 제출</title>
  <style>
    body {
        background: #f7f8fa;
        min-height: 100vh;
        margin: 0;
        font-family: 'Segoe UI', 'Apple SD Gothic Neo', Arial, sans-serif;
    }
    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
    }
    .form-box {
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 4px 24px #0002;
        padding: 40px 32px 32px 32px;
        min-width: 340px;
        max-width: 480px;
    }
    h2 {
        margin-bottom: 32px;
        font-size: 2rem;
        font-weight: 700;
        text-align: center;
        letter-spacing: -1px;
    }
    form {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    label {
        font-weight: 500;
        margin-bottom: 4px;
        text-align: left;
    }
    input, textarea, select {
        border: 1px solid #d1d5db;
        border-radius: 6px;
        padding: 10px;
        font-size: 1rem;
        outline: none;
        width: 100%;
        box-sizing: border-box;
        background: #f9fafb;
        transition: border 0.2s;
    }
    input:focus, textarea:focus, select:focus {
        border: 1.5px solid #4f8cff;
        background: #fff;
    }
    textarea {
        resize: vertical;
        min-height: 100px;
    }
    .radio-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .radio-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .radio-item input[type="radio"] {
        width: auto;
    }
    .radio-item label {
        margin: 0;
        font-weight: normal;
    }
    .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .checkbox-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .checkbox-item input[type="checkbox"] {
        width: auto;
    }
    .checkbox-item label {
        margin: 0;
        font-weight: normal;
    }
    .etc-input {
        margin-left: 20px;
        margin-top: 8px;
    }
    button[type="submit"] {
        margin-top: 12px;
        background: #4f8cff;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 12px 0;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }
    button[type="submit"]:hover {
        background: #2563eb;
    }
    .message {
        color: #22c55e;
        margin-bottom: 12px;
        text-align: center;
    }
    .error {
        color: #ef4444;
        margin-bottom: 12px;
        text-align: center;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="form-box">
    <h2>KUHAS</h2>
    <h2>부원 모집 지원서 제출</h2>
    <div th:if="${message}" class="message" style="padding:32px 0 24px 0;">
      <div style="display:flex; flex-direction:column; align-items:center; gap:16px;">
        <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="32" cy="32" r="32" fill="#4f8cff"/>
          <path d="M18 34L28 44L46 26" stroke="#fff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div style="font-size:1.3rem; font-weight:600; color:#222;">[[${message}]]</div>
        <div style="font-size:1rem; color:#555; margin-top:4px;">KUHAS 지원에 감사드립니다.<br>결과는 이메일로 개별 안내드릴 예정입니다.</div>
        <a href="/" style="margin-top:18px; color:#4f8cff; text-decoration:underline; font-weight:500;">홈으로 돌아가기</a>
      </div>
    </div>
    <div th:if="${error}" class="error" style="padding:32px 0 24px 0;">
      <div style="display:flex; flex-direction:column; align-items:center; gap:16px;">
        <svg width="56" height="56" viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="28" cy="28" r="28" fill="#ef4444"/>
          <path d="M18 18L38 38M38 18L18 38" stroke="#fff" stroke-width="4" stroke-linecap="round"/>
        </svg>
        <div style="font-size:1.15rem; font-weight:600; color:#ef4444;">[[${error}]]</div>
        <div style="font-size:1rem; color:#555; margin-top:4px;">관리자에게 문의하시면 지원서 삭제 및 수정이 가능합니다.</div>
        <a href="/" style="margin-top:18px; color:#4f8cff; text-decoration:underline; font-weight:500;">홈으로 돌아가기</a>
      </div>
    </div>
    <div id="formError" style="display:none; color:#ef4444; background:#fff3f3; border-radius:8px; padding:12px 0; margin-bottom:18px; text-align:center; font-weight:600; scroll-margin-top:40px;"></div>
    <form th:action="@{/api/applications}" method="post" id="applicationForm" th:if="${message} == null">
      <label for="name">이름:</label>
      <input type="text" id="name" name="name" required maxlength="100" autocomplete="name">
      
      <label for="studentId">학번:</label>
      <input type="text" id="studentId" name="studentId" required maxlength="20" autocomplete="off">
      
      <label for="phoneNumber">전화번호:</label>
      <input type="text" id="phoneNumber" name="phoneNumber" required maxlength="20" autocomplete="tel">
      
      <label for="email">이메일:</label>
      <input type="email" id="email" name="email" required maxlength="100" autocomplete="email">
      
      <label for="grade">학년:</label>
      <select id="grade" name="grade" required>
        <option value="">학년을 선택하세요</option>
        <option value="1학년">1학년</option>
        <option value="2학년">2학년</option>
        <option value="3학년">3학년</option>
        <option value="4학년">4학년</option>
      </select>
      
      <label for="motivation">지원동기:</label>
      <textarea id="motivation" name="motivation" required maxlength="2000" rows="6" cols="50" autocomplete="off" placeholder="KUHAS에 지원하게 된 동기를 작성해주세요.(300자 내외)"></textarea>
      
      <label for="otherActivity">기타 활동:</label>
      <textarea id="otherActivity" name="otherActivity" maxlength="1000" rows="4" cols="50" autocomplete="off" placeholder="현재 참여하고 있는 동아리, 학회, 봉사활동 등이 있다면 작성해주세요. (없다면 '없음'이라고 작성해주세요.)"></textarea>
      
      <label for="curriculumReason">커리큘럼 선택 이유:</label>
      <textarea id="curriculumReason" name="curriculumReason" maxlength="1000" rows="4" cols="50" autocomplete="off" placeholder="KUHAS의 커리큘럼 중 관심 있는 분야와 그 이유를 작성해주세요."></textarea>
      
      <label for="wish">희망사항:</label>
      <textarea id="wish" name="wish" maxlength="1000" rows="4" cols="50" autocomplete="off" placeholder="KUHAS에서 하고 싶은 활동이나 배우고 싶은 것들을 작성해주세요."></textarea>
      
      <label for="career">진로 계획:</label>
      <textarea id="career" name="career" maxlength="1000" rows="4" cols="50" autocomplete="off" placeholder="졸업 후 진로계획이나 목표를 작성해주세요."></textarea>
      
      <label for="languageExp">언어 경험:</label>
      <div class="radio-group">
        <div class="radio-item">
          <input type="radio" id="languageExp_yes" name="languageExp" value="있음">
          <label for="languageExp_yes">있음</label>
        </div>
        <div class="radio-item">
          <input type="radio" id="languageExp_no" name="languageExp" value="없음">
          <label for="languageExp_no">없음</label>
        </div>
      </div>
      
      <div id="languageDetailSection" style="display: none;">
        <label for="languageDetail">언어 상세:</label>
        <textarea id="languageDetail" name="languageDetail" maxlength="1000" rows="4" cols="50" autocomplete="off" placeholder="언어 경험에 대한 추가 설명이나 구체적인 경험을 작성해주세요."></textarea>
      </div>
      
      <label for="wishActivities">희망 활동:</label>
      <div class="checkbox-group">
        <div class="checkbox-item">
          <input type="checkbox" id="wishActivities_1" name="wishActivities" value="프로젝트">
          <label for="wishActivities_1">프로젝트</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="wishActivities_2" name="wishActivities" value="스터디">
          <label for="wishActivities_2">스터디</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="wishActivities_3" name="wishActivities" value="세미나">
          <label for="wishActivities_3">세미나</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="wishActivities_4" name="wishActivities" value="기타">
          <label for="wishActivities_4">기타</label>
        </div>
      </div>
      
      <label for="interviewDate">면접 일정:</label>
      <div class="checkbox-group">
        <div class="checkbox-item">
          <input type="checkbox" id="interviewDate_1" name="interviewDate" value="평일 오후">
          <label for="interviewDate_1">평일 오후</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="interviewDate_2" name="interviewDate" value="평일 저녁">
          <label for="interviewDate_2">평일 저녁</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="interviewDate_3" name="interviewDate" value="주말">
          <label for="interviewDate_3">주말</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="interviewDate_4" name="interviewDate" value="기타">
          <label for="interviewDate_4">기타</label>
        </div>
      </div>
      
      <label for="attendType">개강총회 참석 유형:</label>
      <div class="radio-group">
        <div class="radio-item">
          <input type="radio" id="attendType_1" name="attendType" value="개강총회만 참석">
          <label for="attendType_1">개강총회만 참석</label>
        </div>
        <div class="radio-item">
          <input type="radio" id="attendType_2" name="attendType" value="뒷풀이만 참석">
          <label for="attendType_2">뒷풀이만 참석</label>
        </div>
        <div class="radio-item">
          <input type="radio" id="attendType_3" name="attendType" value="둘 다 참석">
          <label for="attendType_3">둘 다 참석</label>
        </div>
      </div>
      
      <label for="privacyAgreement">개인정보 동의:</label>
      <div class="radio-group">
        <div class="radio-item">
          <input type="radio" id="privacyAgreement_yes" name="privacyAgreement" value="예" required>
          <label for="privacyAgreement_yes">예</label>
        </div>
      </div>
      
      <button type="submit">지원서 제출</button>
    </form>
    <!-- 커스텀 모달 영역 -->
    <div id="customModal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35);">
      <div id="customModalBox" style="background:#fff; border-radius:16px; max-width:350px; margin:120px auto 0 auto; padding:32px 24px; box-shadow:0 4px 24px #0002; text-align:center;">
        <div id="customModalMsg" style="font-size:1.1rem; margin-bottom:18px; line-height:1.6;"></div>
        <div id="customModalBtns">
          <button id="customModalOk" style="background:#4f8cff; color:#fff; border:none; border-radius:6px; padding:10px 24px; font-size:1rem; margin-right:12px;">확인</button>
          <button id="customModalCancel" style="background:#e5e7eb; color:#222; border:none; border-radius:6px; padding:10px 24px; font-size:1rem;">취소</button>
        </div>
      </div>
    </div>
    <script>
      const errorDiv = document.getElementById('formError');
      
      // 언어 경험 선택에 따라 언어 상세 섹션 표시/숨김
      document.querySelectorAll('input[name="languageExp"]').forEach(function(radio) {
        radio.addEventListener('change', function() {
          const languageDetailSection = document.getElementById('languageDetailSection');
          if (this.value === '있음') {
            languageDetailSection.style.display = 'block';
          } else {
            languageDetailSection.style.display = 'none';
            document.getElementById('languageDetail').value = '';
          }
        });
      });
      
       function hideError() {
         errorDiv.style.display = 'none';
       }
       document.querySelectorAll('#applicationForm input, #applicationForm textarea, #applicationForm select').forEach(function(el) {
         el.addEventListener('input', hideError);
         el.addEventListener('change', hideError);
       });
       document.getElementById('applicationForm').addEventListener('submit', async function(e) {
           e.preventDefault(); // 항상 먼저 막음
           errorDiv.style.display = 'none';
           let errorMsg = '';
           const missing = [];
           const name = document.getElementById('name').value.trim();
           const studentId = document.getElementById('studentId').value.trim();
           const phoneNumber = document.getElementById('phoneNumber').value.trim();
           const email = document.getElementById('email').value.trim();
           const grade = document.getElementById('grade').value.trim();
           const motivation = document.getElementById('motivation').value.trim();
           const privacyAgreement = document.getElementById('privacyAgreement').value.trim();
           
           if (!name) missing.push('이름');
           if (!studentId) missing.push('학번');
           if (!phoneNumber) missing.push('전화번호');
           if (!email) missing.push('이메일');
           if (!grade) missing.push('학년');
           if (!motivation) missing.push('지원동기');
           if (!privacyAgreement) missing.push('개인정보 동의');
           
           if (missing.length > 0) {
               errorMsg = missing.join(', ') + ' 항목이 작성되지 않았습니다.';
           } else if (!/^[가-힣a-zA-Z\s]+$/.test(name)) {
               errorMsg = '이름은 한글 또는 영문으로만 작성해야 합니다.';
           } else if (!/^\d{10}$/.test(studentId)) {
               errorMsg = '학번은 숫자 10자리로 작성해야 합니다.';
           } else if (!/^[0-9\-]+$/.test(phoneNumber)) {
               errorMsg = '전화번호는 숫자와 -(하이픈)만 작성할 수 있습니다.';
           } else if (phoneNumber.length < 8 || phoneNumber.length > 14) {
               errorMsg = '전화번호는 -(하이픈) 포함 8자 미만, 14자 초과로 입력해 주세요.';
           } else if (motivation.length < 50) {
               errorMsg = '지원동기는 50자 이상 작성해야 합니다.';
           }
           if (errorMsg) {
               errorDiv.textContent = errorMsg;
               errorDiv.style.display = 'block';
               return;
           }
           const ok = await showModal('지원서를 제출하시겠습니까?\n확인을 누르면 제출이 됩니다.\n수정을 원하시면 취소를 눌러주세요.');
           if (ok) {
               e.target.submit(); // 확인 눌렀을 때만 실제 제출
           }
           // 확인을 누르지 않으면 아무 동작도 하지 않음
       });
       // 커스텀 모달 함수
       function showModal(msg, opts = {}) {
         return new Promise((resolve) => {
           const modal = document.getElementById('customModal');
           const msgBox = document.getElementById('customModalMsg');
           const okBtn = document.getElementById('customModalOk');
           const cancelBtn = document.getElementById('customModalCancel');
           msgBox.innerHTML = msg.replace(/\n/g, '<br>');
           modal.style.display = 'block';
           cancelBtn.style.display = '';
           okBtn.focus();
           function close(result) {
             modal.style.display = 'none';
             okBtn.onclick = null;
             cancelBtn.onclick = null;
             modal.onclick = null;
             document.onkeydown = null;
             resolve(result);
           }
           okBtn.onclick = () => close(true);
           cancelBtn.onclick = () => close(false);
           modal.onclick = (e) => { if (e.target === modal) close(false); };
           document.onkeydown = function(e) {
             if (modal.style.display === 'block') {
               if (e.key === 'Escape') { close(false); }
               if (e.key === 'Enter') { close(true); }
             }
           };
         });
       }
    </script>
  </div>
</div>
</body>
</html>